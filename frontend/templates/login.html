{% extends "base.html" %}
{% block content %}
<h1>Login</h1>

<form id="loginForm" class="login-form">
  <input type="email" name="email" placeholder="Email" required />
  <input type="password" name="password" placeholder="Password" required />
  <button type="submit">Log in</button>
</form>

<p id="loginMsg" style="margin-top:8px;color:#cfd3ff;"></p>
<p>Don’t have an account? <a href="/signup">Sign up</a></p>

<script>
  // show ?msg=... if present
  const params = new URLSearchParams(location.search);
  const msg = params.get('msg');
  if (msg) document.getElementById('loginMsg').textContent = msg;

  const form = document.getElementById('loginForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form));

    try {
      const r = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data),
        credentials: 'include'
      });

      if (r.ok) {
        // logged in → go home (dashboard)
        location.href = '/';
      } else {
        const t = await r.text();
        alert('Login failed: ' + t);
      }
    } catch (err) {
      alert('Network error: ' + err);
    }
  });
</script>
{% endblock %}
